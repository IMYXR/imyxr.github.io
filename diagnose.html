<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Tool</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .check {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .pass {
            background: #064e3b;
            color: #6ee7b7;
        }
        .fail {
            background: #7f1d1d;
            color: #fca5a5;
        }
        .warn {
            background: #78350f;
            color: #fcd34d;
        }
        h2 {
            margin-top: 30px;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }
        #globe-container {
            width: 400px;
            height: 400px;
            margin: 20px 0;
            border: 2px solid #3b82f6;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>üîç Globe Diagnostic Tool</h1>

    <h2>Step 1: Check Libraries</h2>
    <div id="lib-checks"></div>

    <h2>Step 2: Check Configuration</h2>
    <div id="config-checks"></div>

    <h2>Step 3: Check DOM</h2>
    <div id="dom-checks"></div>

    <h2>Step 4: Test Globe</h2>
    <div id="globe-checks"></div>
    <div id="globe-container"></div>

    <!-- Load libraries -->
    <script src="https://unpkg.com/three@0.150.0/build/three.min.js"></script>
    <script src="https://unpkg.com/globe.gl@2.27.2/dist/globe.gl.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>

    <script>
        function addCheck(containerId, message, status) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `check ${status}`;
            div.textContent = `${status === 'pass' ? '‚úì' : status === 'fail' ? '‚úó' : '‚ö†'} ${message}`;
            container.appendChild(div);
        }

        // Wait for everything to load
        setTimeout(() => {
            // Check libraries
            console.log('=== CHECKING LIBRARIES ===');

            if (typeof THREE !== 'undefined') {
                addCheck('lib-checks', 'Three.js loaded', 'pass');
                console.log('‚úì Three.js version:', THREE.REVISION);
            } else {
                addCheck('lib-checks', 'Three.js NOT loaded', 'fail');
                console.error('‚úó Three.js missing');
            }

            if (typeof Globe !== 'undefined') {
                addCheck('lib-checks', 'Globe.gl loaded', 'pass');
                console.log('‚úì Globe.gl loaded');
            } else {
                addCheck('lib-checks', 'Globe.gl NOT loaded', 'fail');
                console.error('‚úó Globe.gl missing');
            }

            if (typeof window.supabase !== 'undefined') {
                addCheck('lib-checks', 'Supabase client loaded', 'pass');
                console.log('‚úì Supabase client loaded');
            } else {
                addCheck('lib-checks', 'Supabase client NOT loaded', 'fail');
                console.error('‚úó Supabase client missing');
            }

            // Check configuration
            console.log('=== CHECKING CONFIGURATION ===');

            if (typeof SUPABASE_CONFIG !== 'undefined') {
                addCheck('config-checks', 'SUPABASE_CONFIG defined', 'pass');
                console.log('‚úì Config:', SUPABASE_CONFIG);

                if (SUPABASE_CONFIG.url && SUPABASE_CONFIG.url !== 'YOUR_SUPABASE_URL') {
                    addCheck('config-checks', `URL configured: ${SUPABASE_CONFIG.url}`, 'pass');
                } else {
                    addCheck('config-checks', 'URL not configured', 'fail');
                }

                if (SUPABASE_CONFIG.anonKey && SUPABASE_CONFIG.anonKey !== 'YOUR_SUPABASE_ANON_KEY') {
                    addCheck('config-checks', 'Anon key configured', 'pass');
                } else {
                    addCheck('config-checks', 'Anon key not configured', 'fail');
                }
            } else {
                addCheck('config-checks', 'SUPABASE_CONFIG NOT defined', 'fail');
                console.error('‚úó Config missing');
            }

            // Check DOM
            console.log('=== CHECKING DOM ===');

            const container = document.getElementById('globe-container');
            if (container) {
                addCheck('dom-checks', 'Globe container found', 'pass');
                console.log('‚úì Container:', container);
                console.log('  Width:', container.offsetWidth);
                console.log('  Height:', container.offsetHeight);
            } else {
                addCheck('dom-checks', 'Globe container NOT found', 'fail');
            }

            // Test Supabase connection
            console.log('=== TESTING SUPABASE ===');
            if (typeof window.supabase !== 'undefined' && SUPABASE_CONFIG) {
                try {
                    const client = window.supabase.createClient(
                        SUPABASE_CONFIG.url,
                        SUPABASE_CONFIG.anonKey
                    );
                    addCheck('config-checks', 'Supabase client created successfully', 'pass');
                    console.log('‚úì Client:', client);

                    // Try to fetch data
                    client.from(SUPABASE_CONFIG.tableName)
                        .select('*')
                        .limit(1)
                        .then(({ data, error }) => {
                            if (error) {
                                addCheck('config-checks', `Database error: ${error.message}`, 'fail');
                                console.error('‚úó Database error:', error);
                            } else {
                                addCheck('config-checks', `Database accessible, ${data ? data.length : 0} rows`, 'pass');
                                console.log('‚úì Database data:', data);
                            }
                        });
                } catch (error) {
                    addCheck('config-checks', `Supabase error: ${error.message}`, 'fail');
                    console.error('‚úó Supabase error:', error);
                }
            }

            // Test Globe
            console.log('=== TESTING GLOBE ===');

            if (typeof Globe !== 'undefined' && container) {
                try {
                    const sampleData = [
                        { lat: 35.7796, lng: -78.6382, size: 1, color: '#3b82f6', city: 'Raleigh', country: 'USA', visits: 5 },
                        { lat: 40.7128, lng: -74.0060, size: 0.8, color: '#60a5fa', city: 'New York', country: 'USA', visits: 3 },
                    ];

                    const globe = Globe()
                        (container)
                        .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
                        .pointsData(sampleData)
                        .pointAltitude('size')
                        .pointColor('color')
                        .pointRadius(0.6)
                        .width(400)
                        .height(400);

                    globe.controls().autoRotate = true;
                    globe.controls().autoRotateSpeed = 0.5;

                    addCheck('globe-checks', 'Globe created successfully!', 'pass');
                    console.log('‚úì Globe:', globe);
                } catch (error) {
                    addCheck('globe-checks', `Globe error: ${error.message}`, 'fail');
                    console.error('‚úó Globe error:', error);
                }
            } else {
                addCheck('globe-checks', 'Cannot test globe - missing dependencies', 'fail');
            }

        }, 2000);
    </script>
</body>
</html>
